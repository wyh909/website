$(function(){function n(a){var d,e,b=$("div.bd-role",$("div.winpop")),c=$("input:checkbox",b);for(auIDS=[],a&&(l.index=a),l.name=$("#rolename").val(),d=0,e=c.length;e>d;d++)c.eq(d).attr("checked")&&auIDS.push(c.eq(d).attr("id"));l.auIDS=auIDS.join(";"),l.desc=$("#roledesc").val(),m.newData=l,COMMON.ajaxFn({url:"saveOrUpdateUsers.do",obj:l,callback:function(a){1==a.code&&(k.changeIndex(0),o())}})}function o(){$("div.winpop").hide(),e.hide()}var f,g,i,j,k,l,m,c=(document.location.href,COMMON.getQuery("id"),COMMON.defaultParam),d=$("div.dialog"),e=$("div.mask");thJuese=[{id:"name",name:"角色名称"},{id:"desc",name:"角色描述"}],thXiangmu=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"maintenanceMan",name:"领料人"}],thJindu=[{id:"brand",name:"品牌"},{id:"series",name:"车系"},{id:"miles",name:"公里数"},{id:"type",name:"维修类型"}],thTuijian=[{id:"itemId",name:"推荐项目id"},{id:"itemName",name:"推荐项目名称"},{id:"workType",name:"工种"},{id:"faultCode",name:"错误代码"},{id:"orderNum",name:"顺序号"},{id:"standardWorkTime",name:"标准工时"},{id:"standardUnitPrice",name:"标准单价"},{id:"coastWorkTime",name:"工时花费"}],thGuyuan=[{id:"name",name:"雇员姓名"},{id:"title",name:"头衔"},{id:"teams",name:"班组"},{id:"departmentName",name:"部门"},{id:"earner",name:"收入"},{id:"phone",name:"电话"},{id:"email",name:"邮箱"},{id:"QQ",name:"QQ号码"},{id:"status",name:"状态"}],thPinpai=[{id:"brandId",name:"车辆品牌id"},{id:"brandName",name:"车辆品牌名称"},{id:"brandType",name:"车辆品牌类型"},{id:"brandOrder",name:"顺序号"}],thLeixing=[{id:"modelsId",name:"车辆类型ID"},{id:"modelsName",name:"车辆类型名称"},{id:"manufacturer",name:"生产厂商"},{id:"brand",name:"品牌"},{id:"subBrand",name:"子品牌"},{id:"carType",name:"车种类"},{id:"productTime",name:"生产年份"},{id:"orderId",name:"顺序号"}],thBumen=[{id:"departmentName",name:"部门名称"}],thFuwushang=[{id:"name",name:"服务商名称"},{id:"privice",name:"省"},{id:"city",name:"城市"},{id:"zone",name:"区"}],typeOpt=["全部","预约","未修","在修","已修","内部交车","结算","交车"],classOpt=["保养","维修","美容"],juese={port:"roleList.do",saveport:"roleSaveUpdate.do",itemId:"id",th:thJuese,btntype:1,param:{pageNum:1,pageSize:10},callback:function(){$("a.edit-item").on("click",function(){$("div.winpop").show(),$(".bd-role").show()})}},xiangmu={port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",itemId:"mainId",th:thXiangmu,param:{pageNum:1}},jindu={port:"progressList.do",saveport:"progressSaveorUpdate.do",delport:"progressdelete.do",itemId:"id",th:thJindu,param:{pageNum:1,pageSize:10}},tuijian={port:"ListServiceItem.do",delport:"delServiceItem.do",itemId:"id",th:thTuijian,param:{pageNum:1}},guyuan={port:"listEmployByPage.do",delport:"deleteEmpolyee.do",itemId:"id",th:thGuyuan,param:{pageNum:1}},pinpai={port:"listBrandByPage.do",delport:"deleteBrandById.do",itemId:"id",th:thPinpai,param:{pageNum:1}},leixing={port:"listVehicleTypeByPage.do",delport:"deleteVehicleTypeById.do",saveport:"",itemId:"id",th:thLeixing,param:{pageNum:1}},bumen={port:"listDeptByPage.do",delport:"deleteDept.do",itemId:"id",th:thBumen,param:{pageNum:1}},fuwushang={port:"facilitatorList.do",itemId:"id",th:thFuwushang,param:{pageNum:1}},editXiangmu={itemId:"id",editport:"",saveport:"",editItem:[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"maintenanceMan",name:"领料人"}]},editJindu={itemId:"id",editport:"progressget.do",saveport:"progressSaveorUpdate.do",editItem:[{id:"sequence",name:"序号"},{id:"name",name:"名称"},{id:"costTime",name:"耗时"},{id:"note",name:"备注"}]},editTuijian={itemId:"mainId",edittype:1,editport:"ListServiceItem.do",saveport:"saveOrUpdateItem.do",editItem:[{id:"itemId",name:"推荐项目id",value:""},{id:"itemName",name:"推荐项目名称",value:""},{id:"workType",name:"工种",value:""},{id:"faultCode",name:"错误代码",value:""},{id:"standardWorkTime",name:"标准工时",value:""},{id:"standardUnitPrice",name:"标准单价",value:""},{id:"coastWorkTime",name:"工时花费",value:""},{id:"orderNum",name:"顺序号",value:""}]},editGuyuan={itemId:"id",edittype:1,editport:"listEmployByPage.do",saveport:"saveOrUpdateEmpolyee.do",editItem:[{id:"name",name:"雇员姓名",value:""},{id:"title",name:"头衔",value:""},{id:"teams",name:"班组",value:""},{id:"departmentName",name:"部门",value:""},{id:"sex",name:"性别",value:""},{id:"earner",name:"收入",value:""},{id:"phone",name:"电话",value:""},{id:"email",name:"邮箱",value:""},{id:"QQ",name:"QQ号码",value:""},{id:"status",name:"状态",value:""}]},editPinpai={itemId:"id",edittype:1,editport:"listBrandByPage.do",saveport:"editBrandById.do",editItem:[{id:"id",name:"ID",value:""},{id:"brandName",name:"品牌名 ",value:""},{id:"brandId",name:"品牌ID",value:""},{id:"brandType",name:"品牌类型",value:""},{id:"brandOrder",name:"品牌顺序",value:""}]},editLeixing={itemId:"id",edittype:1,editport:"listVehicleTypeByPage.do",saveport:"editVehicleType.do",editItem:[{id:"modelsId",name:"车辆类型ID",value:""},{id:"modelsName",name:"车辆类型名称",value:""},{id:"manufacturer",name:"生产厂商",value:""},{id:"brand",name:"品牌",value:""},{id:"subBrand",name:"子品牌",value:""},{id:"carType",name:"车种类",value:""},{id:"productTime",name:"生产年份",value:""},{id:"orderId",name:"顺序号",value:""}]},editBumen={itemId:"id",edittype:1,editport:"listDeptByPage.do",saveport:"saveOrUpdateDept.do",editItem:[{id:"departmentName",name:"部门名称",value:""}]},editFuwushang={itemId:"id",edittype:1,editport:"facilitatorList.do",saveport:"facilitatorSaveOrUpdate.do",editItem:[{id:"name",name:"服务商名称",value:""},{id:"province",name:"省",value:"",type:1,option:[]},{id:"city",name:"城市",value:"",type:1,option:[]},{id:"zone",name:"区",value:"",type:1,option:[]}],callback:function(){COMMON.ajaxFn({url:"provinceList.do",obj:{},callback:function(){}})}},f=[juese,xiangmu,jindu,tuijian,guyuan,pinpai,leixing,bumen,fuwushang],g=document.location.href.indexOf("opt.html")>-1,COMMON.getQuery("operation"),g?(COMMON.addTpl({edit:1}),i=["角色管理","项目管理","进度管理","推荐商品管理","雇员管理","车辆品牌管理","车辆类型管理","部门管理","服务商"],j=[,editXiangmu,editJindu,editTuijian,editGuyuan,editPinpai,editLeixing,editBumen,editFuwushang],$("div.opt-tit").html(i[COMMON.getQuery("type")]),COMMON.edit("edit",j[COMMON.getQuery("type")])):(COMMON.addTpl({table:1,th:thJuese}),k=avalon.define("grid",function(a){a.tab=["角色管理","项目管理","进度管理","推荐商品管理","雇员管理","车辆品牌管理","车辆类型管理","部门管理","服务商"],a.curIndex=0,a.th=[],a.tr=[],a.item=[],a.isCheck=!1,a.isOpt=!0,a.nodata='<img src="img/loading.gif"/>',a.changeIndex=function(b,d){a.curIndex=b;var e=f[b],g=$.extend({},c,e.param);a.th.removeAll(),a.th.pushArray(e.th),COMMON.ajaxFn({url:e.port,obj:g,callback:function(b){var c,g,h,i,j,k;if(1==b.code)if(c=null,a.tr=[],b.data){if(c=b.data,3==a.curIndex&&c.recommendItem&&(c.pageName=c.recommendItem.pageName),c.data&&(c=c.data||{}),c instanceof Array?a.tr=c||[]:(g=[],g.push(c),a.tr=g),0==a.curIndex)for(h=0,i=$("tr","table tbody").length;i>h;h++)$("tr","table tbody").eq(h).find("a").last().hide();$("tr.loading","div.item").hide(),j=f[a.curIndex],j.callback&&"function"==typeof j.callback&&j.callback(),k=b.data["total"]||"",k&&$("div.page").pager({pageNumber:d,pageTotal:k,change:function(b){e.pageNum=b,a.changeIndex(h)}})}else $("tr.loading td").html("暂无数据")}})},a.getkey=function(a,b){return k.tr.size()>0&&k.tr[a]?k.tr[a][b]:void 0},a.getId=function(a){var c=k,d=f[c.curIndex];return c.tr.size()>0&&c.tr[a]?0==c.curIndex?"javascript:;":"xitongguanli-opt.html?id="+c.tr[a][d.itemId]+"&type="+c.curIndex:void 0},a.addItem=function(){if(0==a.curIndex){var b=$("div.winpop");b.dialog("show"),$("div.bd-role",b).show()}else location.href="xitongguanli-opt.html?type="+a.curIndex},a.delItem=function(b){var e=f[a.curIndex],g=a.tr[b][e.itemId],h={};d.dialog({title:"窗口提示",content:"确定删除此条数据吗？",button:[{text:"确定",cls:"btn-ok",handler:function(b){h[e.itemId]=g,h=$.extend({},c,h),COMMON.ajaxFn({url:e.delport,obj:h,callback:function(c){1==c.code&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancel",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}}),COMMON.getQuery("type")?k.changeIndex(parseInt(COMMON.getQuery("type"))||0):k.changeIndex(0),l={},m=avalon.define("roleedit",function(a){a.itemId="id",a.roles=["权限1","权限2","权限3","权限4","权限5","权限6"],a.newData={},a.cancelItem=function(){o()},a.saveItem=function(){n()},a.hideDialog=function(){$("div.winpop").hide()}}))});