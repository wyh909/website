$(function(){function a(a,b){COMMON.ajaxFn({url:"listDeptByPage.do",obj:{pageNum:1,pageSize:10},callback:function(c){if(1===c.code){for(var d=c.data.data||{},e=0,f=d.length;f>e;e++)departmentArr.push({text:d[e].departmentName,value:d[e].id});a.item[b].options=departmentArr,a.item[b].selected=d[0].id}}})}function b(){COMMON.ajaxFn({url:"resourcesList.do",obj:{},callback:function(a){if(1===a.code&&a.data){for(var b=a.data.data||[],c=null,d=[],e=0,f=b.length;f>e;e++)c=b[e],d.push({id:c.id,name:c.desc,checked:!1});p.item.roles=d}}})}function c(a){var b=$("div.bd-role",$("div.winpop")),c=$("input:checkbox",b);auIDS=[],a&&(o.id=a),o.name=$("#rolename").val();for(var e=0,f=c.length;f>e;e++)c.eq(e).attr("checked")&&auIDS.push(c.eq(e).attr("id"));o.auIDS=auIDS.join(";"),o.desc=$("#roledesc").val(),p.newData=o,COMMON.ajaxFn({url:"roleSaveUpdate.do",obj:o,callback:function(a){1==a.code&&(n.changeIndex(0),d())}})}function d(){$("div.winpop").hide(),h.hide()}var e=(document.location.href,COMMON.getQuery("id"),COMMON.defaultParam),f={pageNum:1,pageSize:10},g=$("div.dialog"),h=$("div.mask");thJuese=[{id:"name",name:"角色名称"},{id:"desc",name:"角色描述"}],thXiangmu=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"maintenanceMan",name:"领料人"}],thJindu=[{id:"brand",name:"品牌"},{id:"series",name:"车系"},{id:"miles",name:"公里数"},{id:"type",name:"维修类型"}],thTuijian=[{id:"itemId",name:"推荐项目id"},{id:"itemName",name:"推荐项目名称"},{id:"workType",name:"工种"},{id:"faultCode",name:"错误代码"},{id:"orderNum",name:"顺序号"},{id:"standardWorkTime",name:"标准工时"},{id:"standardUnitPrice",name:"标准单价"},{id:"coastWorkTime",name:"工时花费"}],thGuyuan=[{id:"name",name:"员工姓名"},{id:"departmentName",name:"部门"},{id:"title",name:"头衔"},{id:"earner",name:"收入"},{id:"phone",name:"电话"},{id:"email",name:"邮箱"},{id:"QQ",name:"QQ号码"},{id:"status",name:"状态"}],thLeixing=[{id:"modelsId",name:"车辆类型ID"},{id:"modelsName",name:"车辆类型名称"},{id:"manufacturer",name:"生产厂商"},{id:"brand",name:"品牌"},{id:"subBrand",name:"子品牌"},{id:"carType",name:"车种类"},{id:"productTime",name:"生产年份"},{id:"orderId",name:"顺序号"}],thBumen=[{id:"departmentName",name:"部门名称"}],thFuwushang=[{id:"name",name:"服务商名称"},{id:"privice",name:"省"},{id:"city",name:"城市"},{id:"zone",name:"区"}],typeOpt=["全部","预约","未修","在修","已修","内部交车","结算","交车"],classOpt=["保养","维修","美容"],juese={port:"roleList.do",saveport:"roleSaveUpdate.do",itemId:"id",th:thJuese,btntype:1,param:f,callback:function(){$("a.edit-item").on("click",function(){var a=$(this),b=$("div.winpop");b.attr("data-id",a.attr("id")).show(),$(".bd-role").show(),COMMON.ajaxFn({url:"roleList.do",obj:{id:a.attr("id"),pageNum:1,pageSize:10},callback:function(a){if(1===a.code&&a.data){var c=a.data||{};if(c.data){var d=$("input[type=checkbox]",b);c=c.data[0]||{},p.item.name=c.name||"",p.item.desc=c.desc||"";for(var e=0,f=d.length;f>e;e++)c.auIDS&&c.auIDS.indexOf(d.eq(e).attr("id"))>-1&&(p.item.auIDS[e].checked=!0);$("div.winpop").attr("data-id",c.id).show(),$(".bd-role").show()}}}})})}},xiangmu={port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",itemId:"mainId",th:thXiangmu,param:f},jindu={port:"progressList.do",saveport:"progressSaveorUpdate.do",delport:"progressdelete.do",itemId:"id",th:thJindu,param:f},tuijian={port:"ListServiceItem.do",delport:"delServiceItem.do",itemId:"id",th:thTuijian,param:f},guyuan={port:"listEmployByPage.do",delport:"deleteEmpolyee.do",itemId:"id",th:thGuyuan,param:f},leixing={port:"listVehicleTypeByPage.do",delport:"deleteVehicleTypeById.do",saveport:"",itemId:"id",th:thLeixing,param:f},bumen={port:"listDeptByPage.do",delport:"deleteDept.do",itemId:"id",th:thBumen,param:f},fuwushang={port:"facilitatorList.do",delport:"",itemId:"id",th:thFuwushang,param:f,pageClass:"pagefws"},departmentArr=[],editXiangmu={itemId:"id",editport:"",saveport:"",editItem:[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"maintenanceMan",name:"领料人"}]},editJindu={itemId:"id",editport:"progressget.do",saveport:"progressSaveorUpdate.do",editItem:[{id:"sequence",name:"序号"},{id:"name",name:"名称"},{id:"costTime",name:"耗时"},{id:"note",name:"备注"}]},editTuijian={itemId:"mainId",edittype:1,editport:"ListServiceItem.do",saveport:"saveOrUpdateItem.do",editItem:[{id:"itemId",name:"推荐项目id",value:""},{id:"itemName",name:"推荐项目名称",value:""},{id:"workType",name:"工种",value:""},{id:"faultCode",name:"错误代码",value:""},{id:"standardWorkTime",name:"标准工时",value:""},{id:"standardUnitPrice",name:"标准单价",value:""},{id:"coastWorkTime",name:"工时花费",value:""},{id:"orderNum",name:"顺序号",value:""}]},editGuyuan={itemId:"id",edittype:1,editport:"listEmployByPage.do",saveport:"saveOrUpdateEmpolyee.do",editItem:[{id:"name",name:"员工姓名",value:""},{id:"",name:"身份证号",value:"",dataType:"idcard"},{id:"",name:"家庭地址",value:""},{id:"",name:"劳动合同编号",value:""},{id:"aa",name:"是否五险一金",value:"",type:3,options:[{text:"是",value:!0},{text:"否",value:!1}]},{id:"title",name:"头衔",value:""},{id:"teams",name:"班组",value:"",type:1,selected:0,options:[]},{id:"departmentID",name:"部门",value:"",type:1,selected:"departmentArr[0].value",options:departmentArr},{id:"sex",name:"性别",value:"",type:3,options:[{text:"男",value:1},{text:"女",value:0}]},{id:"earner",name:"收入",value:"",dataType:"number"},{id:"phone",name:"电话",value:"",dataType:"phone"},{id:"email",name:"邮箱",value:"",dataType:"email"},{id:"QQ",name:"QQ号码",value:"",dataType:"qq"},{id:"status",name:"状态",value:""}],isJump:!1,callback:function(b,c){a(c,3)}},editLeixing={itemId:"id",edittype:1,editport:"listVehicleTypeByPage.do",saveport:"editVehicleType.do",editItem:[{id:"modelsId",name:"车辆类型ID",value:""},{id:"modelsName",name:"车辆类型名称",value:""},{id:"manufacturer",name:"生产厂商",value:""},{id:"brand",name:"品牌",value:""},{id:"subBrand",name:"子品牌",value:""},{id:"carType",name:"车种类",value:""},{id:"productTime",name:"生产年份",value:""},{id:"orderId",name:"顺序号",value:""}]},editBumen={itemId:"id",edittype:1,editport:"listDeptByPage.do",saveport:"saveOrUpdateDept.do",editItem:[{id:"departmentName",name:"部门名称",value:""}]},provinceList=[],cityList=[],zoneList=[],provinceSelected="",citySelected="",zoneSelected="",editFuwushang={itemId:"id",edittype:1,editport:"facilitatorList.do",saveport:"facilitatorSaveOrUpdate.do",editItem:[{id:"name",name:"服务商名称",value:""},{id:"province",name:"省",value:"",type:1,selected:provinceSelected,options:provinceList},{id:"city",name:"城市",value:"",type:1,selected:citySelected,options:cityList},{id:"zone",name:"区",value:"",type:1,selected:zoneSelected,options:zoneList},{id:"",name:"注册号",value:""},{id:"",name:"税务登记证号",value:""},{id:"",name:"营业执照",value:""},{id:"",name:"开户许可证",value:""},{id:"",name:"法人联系方式",value:""}],callback:function(a,b){function c(a,c,d){COMMON.ajaxFn({url:a,obj:c,callback:function(a){if(1===a.code){for(var c=a.data||[],e=[],f=0,g=c.length;g>f;f++)e.push({text:c[f].name,value:c[f].name});b&&(b.item[d].options=e,b.item[d].selected||(b.item[d].selected=c[0].name))}}})}c("provinceList.do",{},1),c("cityList.do",{province:a.province},2),c("zoneList.do",{city:a.city},3),$("div.opt").unbind("change.select"),$("div.opt").on("change.select","#province",function(){c("cityList.do",{province:b.item[1].selected},2)}).on("change.select","#city",function(){c("zoneList.do",{city:b.item[2].selected},3)})}};var i=[juese,xiangmu,jindu,tuijian,guyuan,leixing,bumen,fuwushang],j=document.location.href.indexOf("opt.html")>-1,k=(COMMON.getQuery("operation"),["角色管理","项目管理","进度管理","推荐商品管理","员工管理","车辆类型管理","部门管理","服务商"]);if(j){COMMON.addTpl({edit:1});var l=COMMON.getQuery("type"),m=[,editXiangmu,editJindu,editTuijian,editGuyuan,editLeixing,editBumen,editFuwushang];$("div.opt-tit").html(k[l]),COMMON.edit("edit",m[l])}else{COMMON.addTpl({table:1,th:thJuese});var n=avalon.define("grid",function(a){a.tab=k,a.curIndex=0,a.th=[],a.tr=[],a.item=[],a.isCheck=!1,a.isOpt=!0,a.pageClass=i[a.curIndex].pageClass,a.nodata='<img src="img/loading.gif"/>',a.changeIndex=function(b,c){a.curIndex=b;var d=i[b],f=$.extend({},e,d.param);f.pageNum=c||1,d.param.pageNum=c||1,a.th.removeAll(),a.th.pushArray(d.th),COMMON.ajaxFn({url:d.port,obj:f,callback:function(b){if(1==b.code){var e=null;if(a.tr=[],b.data){if(e=b.data,3==a.curIndex&&e.recommendItem&&(e.pageName=e.recommendItem.pageName),e.data&&(e=e.data||{}),e instanceof Array)a.tr=e||[];else{var f=[];f.push(e),a.tr=f}if(0==a.curIndex)for(var g=0,h=$("tr","table tbody").length;h>g;g++)$("tr","table tbody").eq(g).find("a").last().hide();$("tr.loading","div.item").hide();var j=i[a.curIndex];j.callback&&"function"==typeof j.callback&&j.callback();for(var k,g=0,h=$("tr","table tbody").length;h>g;g++)k=$("tr","table tbody").eq(g).find("td:first"),k.text(parseInt(k.text())+(j.param.pageNum-1)*j.param.pageSize);var l=b.data.total||"";if(l){var m=$("div.page_"+a.curIndex);m.pager({pageNumber:c,pageTotal:l,change:function(b){d.pageNum=b,a.changeIndex(a.curIndex,d.pageNum)}})}}else $("tr.loading td").html("暂无数据")}}})},a.getkey=function(a,b){return n.tr.size()>0&&n.tr[a]?n.tr[a][b]:void 0},a.getId=function(a){var b=n,c=i[b.curIndex];return b.tr.size()>0&&b.tr[a]?0==b.curIndex?"javascript:;":"xitongguanli-opt.html?id="+b.tr[a][c.itemId]+"&type="+b.curIndex:void 0},a.addItem=function(){if(0==a.curIndex){var b=$("div.winpop"),c=p.item;c.name="",c.desc="";for(var d=0,e=c.auIDS.length;e>d;d++)c.auIDS[d].checked=!1;b.dialog("show"),$("div.bd-role",b).show()}else location.href="xitongguanli-opt.html?type="+a.curIndex},a.delItem=function(b){var c=i[a.curIndex],d=a.tr[b][c.itemId],f={};g.dialog({title:"窗口提示",content:"确定删除此条数据吗？",button:[{text:"确定",cls:"btn-ok",handler:function(b){f[c.itemId]=d,f=$.extend({},e,f),COMMON.ajaxFn({url:c.delport,obj:f,callback:function(c){1==c.code&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancel",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}});COMMON.getQuery("type")?n.changeIndex(parseInt(COMMON.getQuery("type"))||0):n.changeIndex(0);var o={},p=avalon.define("roleedit",function(a){a.item={name:"",roles:[],desc:""},a.itemId="id",a.newData={},a.cancelItem=function(){d()},a.saveItem=function(){c($("div.winpop").attr("data-id"))},a.hideDialog=function(){$("div.winpop").hide()}});b()}});