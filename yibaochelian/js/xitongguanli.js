$(function(){function m(a){var d,e,b=$("div.bd-role",$("div.winpop")),c=$("input:checkbox",b);for(auIDS=[],a&&(k.index=a),k.name=$("#rolename").val(),d=0,e=c.length;e>d;d++)c.eq(d).attr("checked")&&auIDS.push(c.eq(d).attr("id"));k.auIDS=auIDS.join(";"),k.desc=$("#roledesc").val(),l.newData=k,COMMON.ajaxFn({url:"saveOrUpdateUsers.do",obj:k,callback:function(a){1==a.code&&(j.changeIndex(0),n())}})}function n(){$("div.winpop").hide(),e.hide()}var f,g,i,j,k,l,c=(document.location.href,COMMON.getQuery("id"),COMMON.defaultParam),d=$("div.dialog"),e=$("div.mask");thJuese={name:"角色名称",desc:"角色描述"},thXiangmu={itemId:"推荐项目id",itemName:"推荐项目名称",workType:"工种",faultCode:"错误代码",orderNum:"顺序号",standardWorkTime:"标准工时",standardUnitPrice:"标准单价",coastWorkTime:"工时花费"},thJindu={id:"进度id",maintainID:"维修单号",processNum:"进度号",processCount:"进度数",processDetail:"进度状态",costTime:"花费时间"},thTuijian={itemId:"推荐项目id",itemName:"推荐项目名称",workType:"工种",faultCode:"错误代码",orderNum:"顺序号",standardWorkTime:"标准工时",standardUnitPrice:"标准单价",coastWorkTime:"工时花费"},thGuyuan={name:"雇员姓名",title:"头衔",teams:"班组",department:"部门",earner:"收入",phone:"电话",email:"邮箱",QQ:"QQ号码",status:"状态"},thPinpai={brandId:"车辆品牌id",brandName:"车辆品牌名称",brandType:"车辆品牌类型",brandOrder:"顺序号"},thLeixing={modelsId:"车辆类型ID",modelsName:"车辆类型名称",manufacturer:"生产厂商",brand:"品牌",subBrand:"子品牌",carType:"车种类",productTime:"生产年份",orderId:"顺序号"},thBumen={departmentName:"部门名称"},thFuwushang={name:"服务商名称"},typeOpt=["全部","预约","未修","在修","已修","内部交车","结算","交车"],classOpt=["保养","维修","美容"],juese={port:"roleList.do",saveport:"roleSaveUpdate.do",itemId:"id",th:thJuese,btntype:1,param:{pageNum:1,pageSize:10}},xiangmu={port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",itemId:"mainId",th:thXiangmu,param:{pageNum:1}},jindu={port:"orderdetail.do",saveport:"",itemId:"mainId",th:thJindu,param:{pageNum:1}},tuijian={port:"ListServiceItem.do",saveport:"saveOrUpdateItem",delport:"delServiceItem",itemId:"mainId",th:thTuijian,param:{pageNum:1}},guyuan={port:"listEmployByPage.do",saveport:"",itemId:"mainId",th:thGuyuan,param:{pageNum:1}},pinpai={port:"listBrandByPage.do",saveport:"",itemId:"mainId",th:thPinpai,param:{pageNum:1}},leixing={port:"listVehicleTypeByPage.do",saveport:"",itemId:"mainId",th:thLeixing,param:{pageNum:1}},bumen={port:"listDeptByPage.do",saveport:"",itemId:"mainId",th:thBumen,param:{pageNum:1}},fuwushang={port:"facilitatorList.do",saveport:"",itemId:"mainId",th:thFuwushang,param:{pageNum:1}},editTuijian={itemId:"mainId",editport:"ListServiceItem.do",saveport:"saveOrUpdateItem.do",editItem:[{id:"maintainfortNum",name:"维修单号",value:"",type:0},{id:"truename",name:"真实姓名",value:""},{id:"platenumber",name:"车牌号",value:""},{id:"phone",name:"电话",value:""},{id:"maintaintype",name:"类别",value:"",type:1,option:classOpt},{id:"status",name:"状态",value:""},{id:"usedComponents",name:"备注",value:"",type:2}]},f=[juese,xiangmu,jindu,tuijian,guyuan,pinpai,leixing,bumen,fuwushang],g=document.location.href.indexOf("opt.html")>-1,COMMON.getQuery("operation"),g?(COMMON.addTpl({edit:1}),i=["角色管理","项目管理","进度管理","推荐商品管理","雇员管理","车辆品牌管理","车辆类型管理","部门管理","服务商"],$("div.opt-tit").html(i[COMMON.getQuery("type")]),COMMON.edit(editObj)):(COMMON.addTpl({table:1,th:thJuese}),j=avalon.define("grid",function(a){a.tab=["角色管理","项目管理","进度管理","推荐商品管理","雇员管理","车辆品牌管理","车辆类型管理","部门管理","服务商"],a.curIndex=0,a.th=thJuese,a.tr=[],a.item=[],a.changeIndex=function(b,d){a.curIndex=b;var e=f[b],g=$.extend({},c,e.param);a.th=e.th,COMMON.ajaxFn({url:e.port,obj:g,callback:function(b){var c,f,g,h,i;if(1==b.code)if(c=b.data||[],a.tr=[],b.data){if(3==a.curIndex&&c.recommendItem&&(c.pageName=c.recommendItem.pageName),c.data&&(c=c.data||{}),c instanceof Array?a.tr=c||[]:(f=[],f.push(c),a.tr=f),0==a.curIndex)for(g=0,h=$("tr","table tbody").length;h>g;g++)$("tr","table tbody").eq(g).find("a").last().hide();$("tr.loading","div.item").hide(),i=b.data["total"]||"",i&&$("div.page").pager({pageNumber:d,pageTotal:i,change:function(b){e.pageNum=b,a.changeIndex(g)}})}else $("tr.loading td").html("暂无数据")}})},a.getkey=function(a,b){return j.tr.size()>0&&j.tr[a]?j.tr[a][b]:void 0},a.getId=function(a){var c=j;return c.tr.size()>0&&c.tr[a]?0==c.curIndex?"javascript:;":"xitongguanli-opt.html?id="+c.tr[a][c.itemId]+"&type="+c.curIndex:void 0},a.addItem=function(){var a=$("div.winpop");a.dialog("show"),$("div.bd-role",a).show()},a.delItem=function(){var b=a.tr[index][tableObj.itemId],e={};d.dialog({title:"窗口提示",content:"确定删除此条数据吗？",button:[{text:"确定",cls:"btn-ok",handler:function(d){e[tableObj.itemId]=b,e=$.extend({},c,e),ajaxFn({url:tableObj.delport,obj:e,callback:function(b){1==b.code&&(d.dialog("hide"),a.getTr(a,tableObj.port,param,tableObj.callback))}})}},{text:"取消",cls:"btn-cancel",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}}),j.changeIndex(0),k={},l=avalon.define("roleedit",function(a){a.itemId="id",a.roles=["权限1","权限2","权限3","权限4","权限5","权限6"],a.newData={},a.cancelItem=function(){n()},a.saveItem=function(){m()},a.hideDialog=function(){$("div.winpop").hide()}}))});