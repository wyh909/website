$(function(){function i(a,b){var b=$.extend({},{mainId:COMMON.getQuery("id")},b||{}),e=d[a];table_list.th=e.thadd,table_list.tr=[],COMMON.ajaxFn({url:e.addport,obj:b,callback:function(a){var d,e,b=a.data.data||{};for(table_list.tr=b,$("tr.loading").hide(),d=0,e=$("tr",c).length;e>d;d++)$trItem=$("tr",c).eq(d),$("td:first",$trItem).html('<input type="checkbox" id="'+$("td",$trItem).next().attr("data-id")+'" />'),$("th:last",c).hide(),$("td:last",$trItem).hide()}})}var d,e,f,g,h,b=(document.location.href,COMMON.getQuery("id")),c=$("div.dialog");th={maintainfortNum:"维修单号",truename:"真实姓名",platenumber:"车牌号",phone:"电话",maintaintype:"类别",status:"状态"},thYuyue=[{id:"itemId",name:"推荐项目id",width:80},{id:"itemName",name:"推荐项目名称",width:""},{id:"workType",name:"工种",width:""},{id:"faultCode",name:"错误代码",width:""},{id:"standardWorkTime",name:"标准工时",width:""},{id:"standardUnitPrice",name:"标准单价",width:""},{id:"coastWorkTime",name:"工时花费"}],thLingliao=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"maintenanceMan",name:"领料班组"},{id:"maintenanceMan",name:"领料人"}],thDanju=[{id:"maintainID",name:"预约单号"},{id:"checker",name:"检测人"},{id:"checkDate",name:"检测时间"},{id:"Accounter",name:"结算人"},{id:"accountDate",name:"结算时间"},{id:"checkout",name:"收银人"},{id:"checkoutDate",name:"收银时间"},{id:"completionDate",name:"完工时间"},{id:"Outmaker",name:"出厂时间"},{id:"Header",name:"负责人"}],thFeiyong=[{id:"laborCost",name:"工时费"},{id:"materiaCost",name:"材料费"},{id:"otherCost",name:"其他费"},{id:"pageName",name:"套餐"},{id:"totalCost",name:"合计"}],thxmll=[{id:"productID",name:"商品编号"},{id:"productname",name:"商品名称"},{id:"origin",name:"产地"},{id:"type",name:"分类"},{id:"carModle",name:" 车型"},{id:"lastdeliveryDate",name:"最近出货时间"},{id:"lastpurchaseDate",name:" 最近进货时间"},{id:"account",name:"商品可售数量"},{id:"unit",name:"单位（升，个）"},{id:"safeaccount",name:"安全数量"},{id:"suggestBuyprice",name:"建议购买价格"},{id:"suggestSaleprice",name:" 建议销售价格"},{id:"repertory",name:"仓库名称"}],typeOpt=["全部","预约","未修","在修","已修","内部交车","结算","交车"],classOpt=["保养","维修","美容"],optionsType=[{text:"保养",value:"保养"},{text:"维修",value:"维修"},{text:"美容",value:"美容"}],optionsStatus=[{text:"全部",value:"0"},{text:"预约",value:"1"},{text:"未修",value:"2"},{text:"在修",value:"3"},{text:"已修",value:"4"},{text:"内部交车",value:"5"},{text:"结算",value:"6"},{text:"交车",value:"7"}],optionsOil=[{text:"半满",value:"0"},{text:"满",value:"1"}],optionsColor=[{text:"黑",value:"0"},{text:"白",value:"1"},{text:"红",value:"2"},{text:"黄",value:"3"},{text:"蓝",value:"4"},{text:"绿",value:"5"},{text:"银",value:"6"},{text:"橙",value:"7"}],table_list=null,tableObj={id:"table",port:"maintainformList.do",addport:"maintainformInput.do",delport:"maintainformDelete.do",itemId:"maintainfortNum",th:th,param:{pageNum:1}},editObj={itemId:"mainId",editport:"maintainformDetail.do",saveport:"maintainformSaveOrUpdate.do",editItem:[{id:"maintainfortNum",name:"维修单ID",value:""},{id:"maintaintype",name:"维修类型",type:1,selected:"美容",options:optionsType},{id:"truename",name:"客户真实姓名",value:""},{id:"status",name:"状态",type:1,selected:"0",options:optionsStatus},{id:"motorNumber",name:"发动机码",value:""},{id:"oil",name:"油表状态",value:"",type:1,selected:"0",options:optionsOil},{id:"miles",name:"公里数",value:""},{id:"platenumber",name:"车牌",value:""},{id:"qqid",name:"QQ",value:""},{id:"phone",name:"手机",value:""},{id:"color",name:"颜色",type:1,selected:"0",options:optionsColor},{id:"brand",name:"车品牌",value:"",click:{url:"listBrandByPage.do"}},{id:"series",name:"车系",value:"",click:{url:"listVehicleTypeByPage.do"}},{id:"arriveTime",name:"接车时间",value:""},{id:"arriveTime",name:"接车员",value:""},{id:"arriveTime",name:"客户单位",value:""},{id:"address",name:"地址",value:""}]},yuyuexiangmu={id:"childTable",port:"serviceItemList.do",addport:"serviceItemInput.do",saveport:"serviceItemDoSave.do",isOpt:!1,th:thYuyue,btntype:1,param:{pageNum:1}},xiangmulingliao={id:"childTable",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",isOpt:!1,th:thLingliao,thadd:thxmll,param:{pageNum:1}},danjuxinxi={id:"childTable",port:"orderdetail.do",isOpt:!1,th:thDanju,param:{pageNum:1}},feiyongheji={id:"childTable",port:"costsheet.do",th:thFeiyong,param:{pageNum:1}},d=[yuyuexiangmu,xiangmulingliao,danjuxinxi,feiyongheji],e=document.location.href.indexOf("opt.html")>-1,f=COMMON.getQuery("operation"),e?(table_list=avalon.define({$id:"table_list",th:{},tr:[],search:{itemId:"",itemName:""},isCheckbox:!0,isOpt:!0,getkey:function(a,b){var c=table_list;return c.tr.size()>0&&c.tr[a]?c.tr[a][b]:void 0},getId:function(a){var c=g;return c.tr.size()>0&&c.tr[a]?"javascript:;":void 0},_thInit:function(){var b=this;return"width:"+b.th.width},saveItem:function(){var j,k,a="",e=$("input:checkbox",c),f=null,h=g.curIndex,i=d[h].saveport;for(j=0,k=e.length;k>j;j++)f=e.eq(j).attr("id"),e.eq(j).attr("checked")&&(a=a+f+";");COMMON.ajaxFn({url:i,obj:{mainId:b,itemIds:a},callback:function(){c.dialog("hide"),g.changeIndex(h)}})},searchFn:function(){var a={itemId:$("#itemId").val()||"",itemName:$("#itemName").val()||""};i(g.curIndex,a)}}),"add"==f?(COMMON.addTpl({edit:1}),COMMON.edit("edit",editObj)):(COMMON.addTpl({edit:1}),COMMON.edit("edit",editObj)),COMMON.addTpl({table:1,th:th}),g=avalon.define({$id:"childTable",tab:["预约项目","项目领料","单据信息","费用合计","项目进度"],curIndex:0,th:[],tr:[],item:[],isOpt:!0,changeIndex:function(a){var e,b=g;b.curIndex=a,e=d[a],4!==a&&(b.th.removeAll(),b.th.pushArray(e.th),COMMON.ajaxFn({url:e.port,obj:{mainId:COMMON.getQuery("id")},callback:function(a){var d,e;1==a.code&&(d=a.data||[],b.tr=[],!a.data||a.data.length<1?($("tr.loading td").html("暂无数据"),$("tr.loading").show()):(3==b.curIndex&&d.recommendItem&&(d.pageName=d.recommendItem.pageName),d instanceof Array?b.tr=d||[]:(e=[],e.push(d),b.tr=e),1==b.curIndex&&$("table",c).css("width","1200px"),$("tr.loading","div.item").hide()))}}))},getkey:function(a,b){return g.tr.size()>0&&g.tr[a]?g.tr[a][b]:void 0},getId:function(a){var c=g;return c.tr.size()>0&&c.tr[a]?"javascript:;":void 0},addItem:function(){c.dialog("show"),i(g.curIndex),$("#tree").on("click","a",function(){i(g.curIndex,{itemName:$(this).html()})})}}),g.changeIndex(0),h={port:"usedCompontInput.do",obj:COMMON.defaultParam,isFold:!1},TREE.tree($("div.tree"),h)):(COMMON.addTpl({table:1,th:th}),COMMON.table(tableObj))});