$(function(){function D(a){var c=$("div.winpop"),d=$("div.mask"),e=$("div.bd",c);"appointmentTime"==a||(c.show(),d.show(),e.hide(),$("div."+a,c).show())}function E(a,b){var c=$.extend({},COMMON.defaultParam);COMMON.ajaxFn({url:b,obj:c,callback:function(c){if(1==c.code){var d=c.data||{};a.tr="facilitatorList.do"==b?d:d.data||{}}}})}function F(a){var h,i,e=[],f=[],g=$("input:checked",$("div."+a));if("radio"==g.attr("type"))$("#"+a).val(g.val()).attr("data-value",g.attr("data-value"));else{for(h=0,i=g.length;i>h;h++)e.push(g.eq(h).val()),f.push(g.eq(h).attr("data-value"));$("#"+a).val(e.join(";")).attr("data-value",f)}c.hide(),d.hide()}function G(a,b){var b=$.extend({},{mainId:COMMON.getQuery("id")},b||{}),c=w[a];p.th=c.thadd,p.tr=[],b=b||{},COMMON.ajaxFn({url:c.addport,obj:b,callback:function(b){var c=b.data||{},d=c.data||{},e=$("tr.loading",$("div[avalonctrl=table_list]"));d&&d.length>0?(p.tr=d,1==a&&$(".Mtable","div.addyyxm").css("width","1200px"),e.hide()):(p.nodata="暂无数据",e.show())}})}var z,A,B,C,b=(document.location.href,COMMON.getQuery("id")),c=$("div.winpop"),d=$("div.mask"),e=COMMON.OPT,f=e.colorOpt,g=e.oilOpt,h=e.classOpt,i=e.statusOpt,j=[{id:"maintainfortNum",name:"维修单号"},{id:"truename",name:"真实姓名"},{id:"platenumber",name:"车牌号"},{id:"phone",name:"电话"},{id:"maintaintype",name:"类别"},{id:"status",name:"状态"}],k=[{id:"itemId",name:"推荐项目id",width:80},{id:"itemName",name:"推荐项目名称",width:""},{id:"workType",name:"工种",width:""},{id:"faultCode",name:"错误代码",width:""},{id:"standardWorkTime",name:"标准工时",width:""},{id:"standardUnitPrice",name:"标准单价",width:""},{id:"coastWorkTime",name:"工时花费"}],l=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"maintenanceMan",name:"领料班组"},{id:"maintenanceMan",name:"领料人"}],n=[{id:"laborCost",name:"工时费"},{id:"materiaCost",name:"材料费"},{id:"otherCost",name:"其他费"},{id:"pageName",name:"套餐"},{id:"totalCost",name:"合计"}],o=[{id:"productID",name:"商品编号"},{id:"productname",name:"商品名称"},{id:"origin",name:"产地"},{id:"type",name:"分类"},{id:"carModle",name:" 车型"},{id:"lastdeliveryDate",name:"最近出货时间"},{id:"lastpurchaseDate",name:" 最近进货时间"},{id:"account",name:"商品可售数量"},{id:"unit",name:"单位（升，个）"},{id:"safeaccount",name:"安全数量"},{id:"suggestBuyprice",name:"建议购买价格"},{id:"suggestSaleprice",name:" 建议销售价格"},{id:"repertory",name:"仓库名称"}],p=null,q={id:"table",port:"maintainformList.do",addport:"maintainformInput.do",delport:"maintainformDelete.do",itemId:"maintainfortNum",th:j,param:{pageNum:1},callback:function(a){for(var d,b=0,c=a.tr.length;c>b;b++)d=a.tr[b].status,a.tr[b].status=i[d].text}},r={itemId:"mainId",editport:"maintainformDetail.do",saveport:"maintainformSaveOrUpdate.do",editItem:[{id:"maintainfortNum",name:"维修单ID",value:""},{id:"maintaintype",name:"维修类型",type:1,selected:"美容",options:h},{id:"truename",name:"客户真实姓名",value:""},{id:"status",name:"状态",type:1,selected:"0",options:i},{id:"motorNumber",name:"发动机码",value:""},{id:"oil",name:"油表状态",value:"",type:1,selected:"0",options:g},{id:"miles",name:"公里数",value:"",dataType:"number"},{id:"platenumber",name:"车牌",value:""},{id:"qqid",name:"QQ",value:"",dataType:"qq"},{id:"phone",name:"手机",value:"",dataType:"phone"},{id:"color",name:"颜色",type:1,selected:"0",options:f},{id:"brand",name:"车品牌",value:"",click:D},{id:"series",name:"车系",value:"",click:D},{id:"arriveTime",name:"接车时间",value:"",dataType:"time"},{id:"receiveCar",name:"接车员",value:""},{id:"custDept",name:"客户单位",value:""},{id:"address",name:"地址",value:""}],callback:function(a){a.status&&$("span.fred","div.opt-tit").html(i[a.status]["text"])}},s={id:"childTable",port:"serviceItemList.do",addport:"serviceItemInput.do",saveport:"serviceItemDoSave.do",isOpt:!1,isCheck:!0,th:k,thadd:k,btntype:1,param:{pageNum:1}},t={id:"childTable",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",isOpt:!1,th:l,thadd:o,param:{pageNum:1}},u={itemId:"mainId",isJump:!0,editport:"orderdetail.do",saveport:"orderdetail.do",editItem:[{id:"maintainID",name:"预约单号",value:""},{id:"checker",name:"检测人",value:""},{id:"checkDate",name:"检测时间",value:"",dataType:"time"},{id:"Accounter",name:"结算人",value:""},{id:"accountDate",name:"结算时间",value:"",dataType:"time"},{id:"checkout",name:"收银人",value:""},{id:"checkoutDate",name:"收银时间",value:"",dataType:"time"},{id:"completionDate",name:"完工时间",value:"",dataType:"time"},{id:"Outmaker",name:"出厂时间",value:"",dataType:"time"},{id:"Header",name:"负责人",value:""}],callback:function(a){a.status&&$("span.fred","div.opt-tit").html(i[a.status]["text"])}},v={id:"childTable",port:"costsheet.do",th:n,param:{pageNum:1}},w=[s,t,,v],x=document.location.href.indexOf("opt.html")>-1,y=COMMON.getQuery("operation");x?(p=avalon.define("table_list",function(a){a.th=[],a.tr=[],a.search={itemId:"",itemName:""},a.isOpt=!0,a.isCheck=!0,a.nodata='<img src="img/loading.gif"/>',a.getkey=function(a,b){var c=p;return c.tr.size()>0&&c.tr[a]?c.tr[a][b]:void 0},a.getId=function(a){var c=z;return c.tr.size()>0&&c.tr[a]?"javascript:;":void 0},a._thInit=function(){var b=this;return"width:"+b.th.width},a.saveItem=function(){var h,i,a=[],d=$("input:checkbox",c),e=null,f=z.curIndex,g=w[f].saveport;for(h=0,i=d.length;i>h;h++)e=d.eq(h).parent().next("td").text(),d.eq(h).attr("checked")&&a.push(e);COMMON.ajaxFn({url:g,obj:{mainId:b,itemIds:a.join(";")},callback:function(){c.dialog("hide"),z.changeIndex(f)}})},a.searchFn=function(){var a={itemId:$("#itemId").val()||"",itemName:$("#itemName").val()||""};G(z.curIndex,a)}}),"add"==y?(COMMON.addTpl({edit:1}),COMMON.edit("edit",r)):(COMMON.addTpl({edit:1}),COMMON.edit("edit",r)),COMMON.addTpl({table:1,th:j}),z=avalon.define("childTable",function(a){a.tab=["预约项目","项目领料","单据信息","费用合计","项目进度"],a.curIndex=0,a.th=[],a.tr=[],a.isCheck=!1,a.isOpt=!0,a.nodata='<img src="img/loading.gif"/>',a.changeIndex=function(b){var e,f,d=z;d.curIndex=b,e=w[b],0==b||1==b?(f=$("tr.loading",$("div[avalonctrl="+a.$id+"]")),d.th.removeAll(),d.th.pushArray(e.th),COMMON.ajaxFn({url:e.port,obj:{mainId:COMMON.getQuery("id")},callback:function(b){var e,g;1==b.code?(e=b.data||[],d.tr=[],!b.data||b.data.length<1?(a.nodata="暂无数据",f.show()):(3==d.curIndex&&e.recommendItem&&(e.pageName=e.recommendItem.pageName),e instanceof Array?d.tr=e||[]:(g=[],g.push(e),d.tr=g),1==d.curIndex&&$("table",c).css("width","1200px"),$("tr.loading","div.item").hide())):(a.nodata="暂无数据",$("tr.loading","div.item").show())}})):2==b||COMMON.getProcess()},a.getkey=function(a,b){var e,h,f,g,c=z;if(c.tr.size()>0&&z.tr[a]){for(z.tr[a][b],e=null,f=0,g=c.th.length;g>f;f++)if(h=c.th[f],h.id==b&&"time"==h.dataType)return e=c.tr[a][b]||new Date,new Date(e).toLocaleDateString();return c.tr[a][b]}},a.getId=function(a){var c=z;return c.tr.size()>0&&c.tr[a]?"javascript:;":void 0},a.addItem=function(){$("div.bd",c).hide(),$("div.addyyxm",c).show(),c.dialog("show"),G(z.curIndex),$("#tree").on("click","a",function(){G(z.curIndex,{itemName:$(this).html()})})}}),avalon.scan(),z.changeIndex(0),COMMON.edit("dd",u),A={port:"usedCompontInput.do",obj:COMMON.defaultParam,isFold:!1},TREE.tree($("div.tree"),A),B=avalon.define("brand",function(a){a.tr=[],a.getCon=function(){E(a,"listBrandByPage.do"),$.extend({},COMMON.defaultParam)},a.saveItem=function(){F("brand")}}),C=avalon.define("series",function(a){a.tr=[],a.getCon=function(){E(a,"listVehicleTypeByPage.do")},a.saveItem=function(){F("series")}}),avalon.scan(),B.getCon(),C.getCon()):(COMMON.addTpl({table:1,th:j}),COMMON.table(q))});