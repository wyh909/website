$(function(){function a(a,b){var b=$.extend({},{mainId:COMMON.getQuery("id")},b||{}),c=s[a];t.th=c.thadd,t.tr=[],b=b||{},COMMON.ajaxFn({url:c.addport,obj:b,callback:function(b){var c=b.data||{},d=c.data||{},e=$("tr.loading",$("div[avalonctrl=table_list]"));d&&d.length>0?(t.tr=d,1==a&&$(".Mtable","div.add-item").css("width","1200px"),e.hide()):(t.nodata="暂无数据",e.show())}})}var b=COMMON.getQuery("id"),c=COMMON.OPT,d=(c.colorOpt,c.oilOpt),e=c.classOpt,f=c.statusOpt,g=$("div.winpop"),h=$("div.dialog"),i=[{id:"appointmentNum",name:"预约编号"},{id:"maintainfortNum",name:"维修单号"},{id:"truename",name:"姓名"},{id:"platenumber",name:"车牌"},{id:"phone",name:"电话"},{id:"maintaintype",name:"类别"},{id:"status",name:"状态"}],j=[{id:"itemId",name:"推荐项目id",width:80},{id:"itemName",name:"推荐项目名称",width:""},{id:"workType",name:"工种",width:""},{id:"faultCode",name:"错误代码",width:""},{id:"standardWorkTime",name:"标准工时",width:""},{id:"standardUnitPrice",name:"标准单价",width:""},{id:"coastWorkTime",name:"工时花费"}],k=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量",isEdit:!0},{id:"unitprice",name:"单价",isEdit:!0},{id:"teams",name:"领料班组",isEdit:!0},{id:"maintenanceMan",name:"领料人",isEdit:!0}],l=[{id:"productID",name:"商品编号"},{id:"productname",name:"商品名称"},{id:"origin",name:"产地"},{id:"type",name:"分类"},{id:"carModle",name:" 车型"},{id:"lastdeliveryDate",name:"最近出货时间"},{id:"lastpurchaseDate",name:" 最近进货时间"},{id:"account",name:"商品可售数量"},{id:"unit",name:"单位（升，个）"},{id:"safeaccount",name:"安全数量"},{id:"suggestBuyprice",name:"建议购买价格"},{id:"suggestSaleprice",name:" 建议销售价格"},{id:"repertory",name:"仓库名称"}],h=$("div.dialog"),m={id:"table",port:"appointmentList.do",delport:"appointmentDelete.do",itemId:"appointmentNum",th:i,param:{pageNum:1,status:0}},n={itemId:"appointmentNum",id:"appId",editurl:"appointmentDetail.do",saveurl:"appointmentSaveOrUpdate.do",editItem:[{id:"appointmentNum",name:"预约单号",value:""},{id:"truename",name:"姓名",value:""},{id:"platenumber",name:"车牌",value:""},{id:"phone",name:"电话",value:"",dataType:"phone"},{id:"maintaintype",name:"类别",value:"",type:1,selected:"保养",options:e},{id:"status",name:"状态",value:"",type:1,selected:"0",options:f},{id:"oil",name:"油耗",value:"",type:1,selected:"0",options:d},{id:"usedComponents",name:"备注",value:"",type:2}],callback:function(a){$("span.fred","div.opt-tit").html(f[a.status].text)}},o={id:"yuyuexiangmu",port:"serviceItemList.do",addport:"serviceItemInput.do",saveport:"serviceItemDoSave.do",th:j,thadd:j,btntype:1,param:{pageNum:1}},p={id:"yuyuepeijian",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",isOpt:!1,btntype:1,th:k,thadd:l,param:{pageNum:1}},q=document.location.href.indexOf("opt.html")>-1;if(q){COMMON.addTpl({edit:1}),COMMON.addTpl({table:1,th:i}),COMMON.edit("edit",n);var r={port:"usedCompontInput.do",obj:COMMON.defaultParam,isFold:!1};TREE.tree($("div.tree"),r);var s=[o,p];child=avalon.define("grid",function(b){b.tab=["预约项目","预约配件"],b.curIndex=0,b.th=[],b.tr=[],b.item=[],b.newData=[],b.isCheck=b.curIndex.isCheck===!0?!0:!1,b.nodata='<img src="img/loading.gif"/>',b.isOpt=!0,b.changeIndex=function(a,c){b.curIndex=a;var d=s[a],e={mainId:COMMON.getQuery("id")};b.th.removeAll(),b.th.pushArray(d.th),COMMON.ajaxFn({url:d.port,obj:e,callback:function(a){if(1==a.code){var e=null;if(b.tr=[],a.data){if(e=a.data||{},3==b.curIndex&&e.recommendItem&&(e.pageName=e.recommendItem.pageName),e.data){if(e=e.data||{},e instanceof Array)b.tr=e||[];else{var f=[];f.push(e),b.tr=f}if(0==b.curIndex)for(var g=0,h=$("tr","table tbody").length;h>g;g++)$("tr","table tbody").eq(g).find("a").last().hide();$("tr.loading").hide()}else b.nodata="暂无数据",$("tr.loading").show();var i=a.data.total||"";i&&$("div.page").pager({pageNumber:c,pageTotal:i,change:function(a){d.pageNum=a,b.changeIndex(g)}})}else b.nodata="暂无数据",$("tr.loading").show()}}})},b.getkey=function(a,b){var c=child;if(c.tr.size()>0&&child.tr[a]){for(var d=(child.tr[a][b],s[c.curIndex].th),e=null,f=null,g=0,h=d.length;h>g;g++)if(f=d[g],f.id==b&&"time"==f.dataType)return e=c.tr[a][b]||new Date,new Date(e).toLocaleDateString();return c.tr[a][b]}},b.getId=function(a,b){var c=child;return c.tr.size()>0&&c.tr[a]?"javascript:;":void 0},b.addItem=function(){$("div.bd",g).hide(),$("div.add-item",g).show(),g.dialog("show"),a(child.curIndex),$("#tree").on("click","a",function(){a(child.curIndex,{itemName:$(this).html()})})},b.delItem=function(a){var c=s[b.curIndex],d=b.tr[a][c.itemId],e={};h.dialog({title:"窗口提示",content:"确定删除此条数据吗？",button:[{text:"确定",cls:"btn-ok",handler:function(a){e[c.itemId]=d,e=$.extend({},defaultParam,e),COMMON.ajaxFn({url:c.delport,obj:e,callback:function(c){1==c.code&&(a.dialog("hide"),b.changeIndex(b.curIndex))}})}},{text:"取消",cls:"btn-cancel",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}});var t=avalon.define("table_list",function(c){c.th=[],c.tr=[],c.search={itemId:"",itemName:""},c.isOpt=!1,c.isCheck=!0,c.nodata='<img src="img/loading.gif"/>',c.getkey=function(a,b){var c=t;return c.tr.size()>0&&c.tr[a]?c.tr[a][b]:void 0},c.getId=function(a,b){var c=child;return c.tr.size()>0&&c.tr[a]?"javascript:;":void 0},c._thInit=function(a){var b=this;return"width:"+b.th.width},c.saveItem=function(){for(var a=[],c=$("input:checkbox",g),d=null,e=child.curIndex,f=s[e].saveport,h=0,i=c.length;i>h;h++)d=c.eq(h).parent().next("td").text(),c.eq(h).attr("checked")&&a.push(d);COMMON.ajaxFn({url:f,obj:{mainId:b,itemIds:a.join(";")},callback:function(a){g.dialog("hide"),child.changeIndex(e)}})},c.searchFn=function(){var b={itemId:$("#itemId").val()||"",itemName:$("#itemName").val()||""};a(child.curIndex,b)}});avalon.scan(),child.changeIndex(0)}else COMMON.addTpl({table:1,th:i}),COMMON.table(m)});