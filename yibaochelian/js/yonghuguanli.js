$(function(){function p(){j=avalon.define({$id:"useredit",itemId:"id",item:e.editItem,newData:n,change:function(a){n[a.target.getAttribute("data-id")]=a.target.value},cancelItem:function(){r()},saveItem:function(){var a=$("div.bd-user",l);n.name=$("#name",a).val(),n.dept=$("#dept",a).val(),n.account=$("#account",a).val(),n.rolename=$("#rolename",a).val(),n.duty=$("#duty",a).val(),j.newData=n,COMMON.ajaxFn({url:"saveOrUpdateUsers.do",obj:n,callback:function(a){1==a.code&&(s(),r())}})}}),k=avalon.define({$id:"roleedit",itemId:"id",roles:["权限1","权限2","权限3","权限4","权限5","权限6"],newData:o,cancelItem:function(){r()},saveItem:function(){t()}}),h=avalon.define({$id:"table",th:a,tr:[],ids:[],rolenames:[],getkey:function(a,b){return h.tr.size()>0&&h.tr[a]?h.tr[a][0][b]:void 0},addItem:function(){q("user","add")},editItem:function(a){$("div.bd-role",l).hide(),$("div.bd-user",l).hide(),q("user","edit",a),n.id=a},delItem:function(a){COMMON.ajaxFn({url:"deleteUsersById.do",obj:{id:a},callback:function(a){1==a.code?s():alert("删除失败")}})}}),i=avalon.define({$id:"roletable",th:b,tr:[],getkey:function(a,b){return i.tr.size()>0&&i.tr[a]?i.tr[a][b]:void 0},addItem:function(){q("role","add")},editItem:function(a,b){$("div.bd-user",l).hide(),$("div.bd-role",l).hide(),q("role","edit",a,b)}}),s(),s("role"),j.item[1].value="aa"}function q(a,b,c,d){var p,q,h="add"==b?"添加用户":"编辑用户",i="",k=$("div.dialog"),l=$("div.bd-role",k),n=$("div.bd-user",k);if($("div.hd",k).html(h),"user"==a?(i=f.port,n.show(),l.hide()):(i=g.port,l.show(),n.hide(),$("#rolename",l).val(d)),k.show(),m.show(),"add"!=b)"user"==a?($("#account").parent().parent().hide(),COMMON.ajaxFn({url:i,obj:{id:c},callback:function(b){var d,f,g,h,i,l,n;if(b={},b.code=2,b.data={},b.data.data=[{name:"zhansan",auIDS:[1,2,3]}],1==b.code){if(d=b.data.data||{},f={},g={},h=null,i=null,"user"==a){for(d=d[0][0],f=e.editItem,l=0,n=f.length;n>l;l++)h=f[l]["id"],i=d[h]||"",j.item[l].value=i,g[h]=i;g.id=c,j.newData=g}k.show(),m.show()}}})):(o.roleId=c,k.show(),m.show());else for($("#account").parent().parent().show(),p=0,q=e.editItem.length;q>p;p++)j.item[p].value=""}function r(){l.hide(),m.hide()}function s(a){var b=null,c=null;"role"==a?(b=$.extend({},d,g.param),c=g.port):(b=$.extend({},d,f.param),c=f.port),COMMON.ajaxFn({url:c,obj:b,callback:function(b){if(1==b.code){var c=b.data||{};$("tr.loading").hide(),"role"==a?i.tr=c:h.tr=c.data}}})}function t(a){var d,e,b=$("div.bd-role",l),c=$("input:checkbox",b);for(auIDS=[],a&&(o.index=a),o.name=$("#rolename").val(),d=0,e=c.length;e>d;d++)c[d].checked?auIDS.push("1"):auIDS.push("0");o.auIDS=auIDS.join(";"),o.desc=$("#roledesc").val(),k.newData=o,COMMON.ajaxFn({url:"saveOrUpdateUsers.do",obj:o,callback:function(a){1==a.code&&(s("role"),r())}})}var a={name:"姓名",account:"账号"},b={name:"角色名称",desc:"角色描述"},c=["角色1","角色2","角色3"],d={facilitatorID:COMMON.getCookie("facilitatorID")||1,companyUserID:COMMON.getCookie("companyUserID")||1},e={itemId:"id",editItem:[{id:"name",name:"姓名",value:"1",type:0},{id:"dept",name:"部门",value:""},{id:"account",name:"账号",value:""},{id:"rolename",name:"密码关联角色名称",type:1,option:c},{id:"duty",name:"职责",value:""}]},f={id:"table",port:"listUsersByPage.do",saveport:"saveOrUpdateUsers.do",delport:"deleteUsersById.do",itemId:"id",th:a,param:{pageNum:1,pageSize:10}},g={id:"table",port:"roleList.do",saveport:"roleSaveUpdate.do",itemId:"id",th:b,param:{pageNum:1,pageSize:10}},h=null,i=null,j=null,k=null,l=$("div.dialog"),m=$("div.mask"),n={},o={};p()});