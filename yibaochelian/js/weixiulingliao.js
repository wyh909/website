$(function(){var a=document.location.href.indexOf("opt.html")>-1,b=COMMON.defaultParam,d=[],e="钣金1组",f=[{id:"maintainfortNum",name:"维修单号"},{id:"truename",name:"真实姓名"},{id:"platenumber",name:"车牌号"},{id:"phone",name:"电话"},{id:"maintaintype",name:"类别"},{id:"status",name:"状态"}],g={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:f,isOpt:!0,param:{pageNum:1,isMaterial:0}},h={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:f,isOpt:!0,param:{pageNum:1,isMaterial:1}},i={itemId:"appointmentNum",id:"appId",editurl:"listMaterialByPage.do",saveurl:"materialSaveOrUpdate.do",editItem:[{id:"orderNum",name:"单号",value:""},{id:"auditDate",name:"开单日期",value:""},{id:"maintainforNum",name:"维修单号",value:""},{id:"carOwner",name:"客户姓名",value:""},{id:"auditor",name:"开单员",value:""},{id:"identityNum",name:"识别号"},{id:"platenumber",name:"车牌号",value:""},{id:"teams",name:"班组",value:"",type:1,selected:e,options:d},{id:"employee",name:"领料员",value:""},{id:"depotManager",name:"仓管员",value:""},{id:"priseScheme",name:"售价方案",value:""},{id:"note",name:"备注",value:""}]},j={id:"table",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:f,param:{pageNum:1,status:0}};COMMON.ajaxFn({url:"listTeams.do",obj:{},callback:function(a){var b,c,f;if(1==a.code){for(b=a.data||[],c=0,f=b.length;f>c;c++)d.push({text:b[c],value:b[c]});e=b[0]}}}),setTimeout(function(){if(COMMON.addTpl({table:1,th:f}),a)COMMON.addTpl({table:1,th:f}),COMMON.addTpl({edit:1}),COMMON.edit("edit",i),COMMON.table(j);else{var c=[g,h],d=avalon.define("grid",function(a){a.tab=["未领料","已领料"],a.curIndex=0,a.th=[],a.tr=[],a.item=[],a.nodata='<img src="img/loading.gif"/>',a.isCheck=c[a.curIndex].isCheck||!1,a.isOpt=c[a.curIndex].isOpt||!1,a.changeIndex=function(d,e){a.curIndex=d;var f=c[d];a.th=f.th,param=$.extend({},b,f.param),param.pageNum=e||1,param.pageSize=10,COMMON.ajaxFn({url:f.port,obj:param,callback:function(b){var c,d,g,h,i;(1==b.code||1==b.ret)&&(c=b.data.data||[],a.tr=[],b.data?(c instanceof Array?a.tr=c||[]:(d=[],d.push(c),a.tr=d),$("tr.loading","div.tabitem").hide(),$("a.delete-item").hide(),g=$("div.page_"+a.curIndex),h=b.data["total"]||"",h&&1!=h?(g.show(),i=h,g.pager({pageNumber:e,pageTotal:i,change:function(b){f.param.pageNum=b,a.changeIndex(a.curIndex,b)}})):g.hide()):$("tr.loading td").html("暂无数据"))}})},a.getkey=function(a,b){return d.tr.size()>0&&d.tr[a]?d.tr[a][b]:void 0},a.getId=function(b){var f=d,g="",h=f.tr[b];return c[b],1==a.curIndex?g="&type=0":2==a.curIndex&&(g="&type=1"),f.tr.size()>0&&f.tr[b]?"weixiulingliao-opt.html?id="+(h.appointmentNum||"")+"&carOwner="+(h.truename||"")+"&platenumber="+(h.platenumber||"")+g:void 0},a.addItem=function(){location.href="kufangguanli-opt.html"},a.editItem=function(){},a.saveItem=function(){$dialog.dialog("show"),editDialog(d.curIndex),$("#tree").on("click","a",function(){editDialog(d.curIndex,{itemName:$(this).html()})})},a.delItem=function(b){var d=c[a.curIndex],e=a.tr[b][d.itemId];$("div.dialog").dialog({title:"窗口提示",content:"确定删除此条数据吗",button:[{text:"确定",cls:"btn-ok",handler:function(b){COMMON.ajaxFn({url:d.delport,obj:{id:e},callback:function(c){(1==c.code||1==c.ret)&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancal",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}});avalon.scan(),d.changeIndex(0)}},100)});