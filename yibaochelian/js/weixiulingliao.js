$(function(){var a=document.location.href.indexOf("opt.html")>-1,b=COMMON.defaultParam,c=1,d=[],e="钣金1组",f=[{id:"maintainfortNum",name:"维修单号"},{id:"truename",name:"真实姓名"},{id:"platenumber",name:"车牌号"},{id:"phone",name:"电话"},{id:"maintaintype",name:"类别"},{id:"status",name:"状态"}],g={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:f,isOpt:!0,param:{pageNum:1,isMaterial:0}},h={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:f,isOpt:!0,param:{pageNum:1,isMaterial:1}},i={itemId:"appointmentNum",id:"appId",editurl:"listMaterialByPage.do",saveurl:"materialSaveOrUpdate.do",editItem:[{id:"orderNum",name:"单号",value:""},{id:"auditDate",name:"开单日期",value:""},{id:"maintainforNum",name:"维修单号",value:""},{id:"carOwner",name:"客户姓名",value:""},{id:"auditor",name:"开单员",value:""},{id:"identityNum",name:"识别号"},{id:"platenumber",name:"车牌号",value:""},{id:"teams",name:"班组",value:"",type:1,selected:e,options:d},{id:"employee",name:"领料员",value:""},{id:"depotManager",name:"仓管员",value:""},{id:"priseScheme",name:"售价方案",value:""},{id:"note",name:"备注",value:""}]},j={id:"table",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:f,param:{pageNum:1,status:0}};COMMON.ajaxFn({url:"listTeams.do",obj:{},callback:function(a){var b,c,f;if(1==a.code){for(b=a.data||[],c=0,f=b.length;f>c;c++)d.push({text:b[c],value:b[c]});e=b[0]}}}),setTimeout(function(){if(COMMON.addTpl({table:1,th:f}),a)COMMON.addTpl({table:1,th:f}),COMMON.addTpl({edit:1}),COMMON.edit("edit",i),COMMON.table(j);else{var d=[g,h],e=avalon.define("grid",function(a){a.tab=["未领料","已领料"],a.curIndex=0,a.th=[],a.tr=[],a.item=[],a.nodata='<img src="img/loading.gif"/>',a.isCheck=d[a.curIndex].isCheck||!1,a.isOpt=d[a.curIndex].isOpt||!1,a.changeIndex=function(e){a.curIndex=e;var f=d[e];a.th=f.th,COMMON.ajaxFn({url:f.port,obj:b,callback:function(b){var d,e,f,g,h;(1==b.code||1==b.ret)&&(d=b.data.data||[],a.tr=[],b.data?(d instanceof Array?a.tr=d||[]:(e=[],e.push(d),a.tr=e),$("tr.loading","div.tabitem").hide(),$("a.delete-item").hide(),f=$("div.page"),g=b.data["total"]||"",g&&1!=g?(f.show(),h=g,f.pager({pageNumber:c,pageTotal:h,change:function(a){param.pageNum=a,getData(url,param,function(){tableModel.getNum(a)})}})):f.hide()):$("tr.loading td").html("暂无数据"))}})},a.getkey=function(a,b){return e.tr.size()>0&&e.tr[a]?e.tr[a][b]:void 0},a.getId=function(b){var c=e,f="",g=c.tr[b];return d[b],1==a.curIndex?f="&type=0":2==a.curIndex&&(f="&type=1"),c.tr.size()>0&&c.tr[b]?"weixiulingliao-opt.html?id="+(g.appointmentNum||"")+"&carOwner="+(g.truename||"")+"&platenumber="+(g.platenumber||"")+f:void 0},a.addItem=function(){location.href="kufangguanli-opt.html"},a.editItem=function(){},a.saveItem=function(){$dialog.dialog("show"),editDialog(e.curIndex),$("#tree").on("click","a",function(){editDialog(e.curIndex,{itemName:$(this).html()})})},a.delItem=function(b){var c=d[a.curIndex],e=a.tr[b][c.itemId];$("div.dialog").dialog({title:"窗口提示",content:"确定删除此条数据吗",button:[{text:"确定",cls:"btn-ok",handler:function(b){COMMON.ajaxFn({url:c.delport,obj:{id:e},callback:function(c){(1==c.code||1==c.ret)&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancal",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}});avalon.scan(),e.changeIndex(0)}},100)});