$(function(){function o(a){var e,f,g,h,i,b=["角","分"],c=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],d=[["元","万","亿"],["","拾","佰","仟"]];for(a=a.replace(/\,/g,""),e=0>a?"欠":"",a=Math.abs(a),f="",g=0;g<b.length;g++)f+=(c[Math.floor(10*a*Math.pow(10,g))%10]+b[g]).replace(/零./,"");for(f=f||"整",a=Math.floor(a),g=0;g<d[0].length&&a>0;g++){for(h="",i=0;i<d[1].length&&a>0;i++)h=c[a%10]+d[1][i]+h,a=Math.floor(a/10);f=h.replace(/(零.)*零$/,"").replace(/^$/,"零")+d[0][g]+f}return e+f.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}var a=document.location.href.indexOf("opt.html")>-1,b=COMMON.defaultParam,d=[],e="钣金1组",f=decodeURIComponent(COMMON.getQuery("id")),g=decodeURIComponent(COMMON.getQuery("carOwner")),h=decodeURIComponent(COMMON.getQuery("platenumber")),i=[{id:"maintainfortNum",name:"维修单号"},{id:"truename",name:"真实姓名"},{id:"platenumber",name:"车牌号"},{id:"phone",name:"电话"},{id:"maintaintype",name:"类别"},{id:"status",name:"状态"}],j=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"teams",name:"领料班组"},{id:"maintenanceMan",name:"领料人"}],k={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:i,isOpt:!0,param:{pageNum:1,isMaterial:0}},l={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:i,isOpt:!0,param:{pageNum:1,isMaterial:1}},m={itemId:"maintainfortNum",id:"mainId",edittype:"1",editurl:"listMaterialByPage.do",saveurl:"materialSaveOrUpdate.do",editItem:[{id:"auditDate",name:"开单日期",value:"",dataType:"time"},{id:"maintainforNum",name:"维修单号",value:f},{id:"truename",name:"客户姓名",value:g},{id:"auditor",name:"开单员",value:""},{id:"identityNum",name:"识别号"},{id:"plateNumber",name:"车牌号",value:h,dataType:"plate"},{id:"teams",name:"班组",value:"",type:1,selected:e,options:d},{id:"employee",name:"领料员",value:""},{id:"depotManager",name:"仓管员",value:""},{id:"priseScheme",name:"售价方案",value:""},{id:"note",name:"备注",value:""}],callback:function(a,b){var f,c=b.item[6];COMMON.ajaxFn({url:"listTeams.do",obj:{},callback:function(a){var b,f,g;if(1==a.code){for(b=a.data||[],f=0,g=b.length;g>f;f++)d.push({text:b[f],value:b[f]});e=b[0],c.selected=b[0],c.options=d}}}),a=a[0],f=$("div.total"),a&&($("em.total-total",f).html(a.productnum||"0"),$("em.sale-amount",f).html(a.unitprice||"0"),$("em.chinese-amount",f).html(o(a.unitprice||"0")))}},n={id:"table",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:j,param:{mainId:f}};setTimeout(function(){var c,d,e,f,h,j,p,q,r,s,t;if(COMMON.addTpl({table:1,th:i}),a)for(COMMON.addTpl({table:1,th:i}),COMMON.addTpl({edit:1}),m.editurl=0==COMMON.getQuery("type")?"":"listMaterialByPage.do",COMMON.edit("edit",m),COMMON.table(n),e=new Date,f=e.getFullYear(),h=e.getMonth(),j=e.getDate(),p=$("div.total"),q=$("div.item",p),r=[],10>h&&(h="0"+h),10>j&&(j="0"+j),r=["0","0",o("0"),g,g,f+"/"+h+"/"+j],s=0,t=q.length;t>s;s++)$("em",q.eq(s)).html(r[s]);else c=[k,l],d=avalon.define("grid",function(a){a.tab=["未领料","已领料"],a.curIndex=0,a.th=[],a.tr=[],a.item=[],a.nodata='<img src="img/loading.gif"/>',a.isCheck=c[a.curIndex].isCheck||!1,a.isOpt=c[a.curIndex].isOpt||!1,a.changeIndex=function(d,e){a.curIndex=d;var f=c[d];a.th=f.th,param=$.extend({},b,f.param),param.pageNum=e||1,param.pageSize=10,COMMON.ajaxFn({url:f.port,obj:param,callback:function(b){var c,d,g,h,i;(1==b.code||1==b.ret)&&(c=b.data.data||[],a.tr=[],b.data?(c instanceof Array?a.tr=c||[]:(d=[],d.push(c),a.tr=d),$("tr.loading","div.tabitem").hide(),0==a.curIndex?$("a.edit-item").html("领料"):$("a.edit-item").html("编辑"),$("a.delete-item").hide(),g=$("div.page_"+a.curIndex),h=b.data["total"]||"",h&&1!=h?(g.show(),i=h,g.pager({pageNumber:e,pageTotal:i,change:function(b){f.param.pageNum=b,a.changeIndex(a.curIndex,b)}})):g.hide()):$("tr.loading td").html("暂无数据"))}})},a.getkey=function(a,b){return d.tr.size()>0&&d.tr[a]?d.tr[a][b]:void 0},a.getId=function(b){var f=d,g="",h=f.tr[b];return c[b],0==a.curIndex?g="&type=0":1==a.curIndex&&(g="&type=1"),f.tr.size()>0&&f.tr[b]?"weixiulingliao-opt.html?id="+(h["maintainfortNum"]||"")+"&carOwner="+(h.truename||"")+"&platenumber="+(h.platenumber||"")+g:void 0},a.addItem=function(){location.href="weixiulingliao-opt.html"},a.editItem=function(){},a.saveItem=function(){$dialog.dialog("show"),editDialog(d.curIndex),$("#tree").on("click","a",function(){editDialog(d.curIndex,{itemName:$(this).html()})})},a.delItem=function(b){var d=c[a.curIndex],e=a.tr[b][d.itemId];$("div.dialog").dialog({title:"窗口提示",content:"确定删除此条数据吗",button:[{text:"确定",cls:"btn-ok",handler:function(b){COMMON.ajaxFn({url:d.delport,obj:{id:e},callback:function(c){(1==c.code||1==c.ret)&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancal",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}}),avalon.scan(),d.changeIndex(0)},100)});