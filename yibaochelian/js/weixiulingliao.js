$(function(){function a(a){var b=["角","分"],c=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],d=[["元","万","亿"],["","拾","佰","仟"]];a=""+a,a=a.replace(/\,/g,"");var e=0>a?"欠":"";a=Math.abs(a);for(var f="",g=0;g<b.length;g++)f+=(c[Math.floor(10*a*Math.pow(10,g))%10]+b[g]).replace(/零./,"");f=f||"整",a=Math.floor(a);for(var g=0;g<d[0].length&&a>0;g++){for(var h="",i=0;i<d[1].length&&a>0;i++)h=c[a%10]+d[1][i]+h,a=Math.floor(a/10);f=h.replace(/(零.)*零$/,"").replace(/^$/,"零")+d[0][g]+f}return e+f.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}var b=document.location.href.indexOf("opt.html")>-1,c=COMMON.defaultParam,d=[],e="钣金1组",f=decodeURIComponent(COMMON.getQuery("id")),g=decodeURIComponent(COMMON.getQuery("carOwner")),h=decodeURIComponent(COMMON.getQuery("platenumber")),i=[{id:"maintainfortNum",name:"维修单号"},{id:"truename",name:"真实姓名"},{id:"platenumber",name:"车牌号"},{id:"phone",name:"电话"},{id:"maintaintype",name:"类别"},{id:"status",name:"状态"}],j=[{id:"productID",name:"商品编码"},{id:"productname",name:"商品名称"},{id:"unit",name:"单位"},{id:"productnum",name:"数量"},{id:"unitprice",name:"单价"},{id:"teams",name:"领料班组"},{id:"maintenanceMan",name:"领料人"}],k={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:i,isOpt:!0,param:{pageNum:1,isMaterial:0}},l={itemId:"maintainfortNum",port:"maintainformList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:i,isOpt:!0,param:{pageNum:1,isMaterial:1}},m={itemId:"maintainfortNum",id:"mainId",edittype:"1",editurl:"listMaterialByPage.do",saveurl:"materialSaveOrUpdate.do",editItem:[{id:"auditDate",name:"开单日期",value:"",dataType:"time"},{id:"maintainforNum",name:"维修单号",value:f},{id:"truename",name:"客户姓名",value:g},{id:"auditor",name:"开单员",value:""},{id:"identityNum",name:"识别号"},{id:"plateNumber",name:"车牌号",value:h,dataType:"plate"},{id:"teams",name:"班组",value:"",type:1,selected:e,options:d},{id:"employee",name:"领料员",value:""},{id:"depotManager",name:"仓管员",value:""},{id:"priseScheme",name:"售价方案",value:""},{id:"note",name:"备注",value:""}],callback:function(a,b){var c=b.item[6];COMMON.ajaxFn({url:"listTeams.do",obj:{},callback:function(a){if(1==a.code){for(var b=a.data||[],f=0,g=b.length;g>f;f++)d.push({text:b[f],value:b[f]});e=b[0],c.selected=b[0],c.options=d}}})}},n={id:"table",port:"usedCompontList.do",addport:"usedCompontInput.do",saveport:"usedCompentDoSave.do",th:j,param:{mainId:f},callback:function(b){var c=b.tr[0],d=$("div.total");c&&($("em.total-total",d).html(c.productnum||"0"),$("em.sale-amount",d).html(c.unitprice||"0"),$("em.chinese-amount",d).html(a(c.unitprice||"0")))}};setTimeout(function(){if(COMMON.addTpl({table:1,th:i}),b){COMMON.addTpl({table:1,th:i}),COMMON.addTpl({edit:1}),0==COMMON.getQuery("type")?m.editurl="":m.editurl="listMaterialByPage.do",COMMON.edit("edit",m),COMMON.table(n);var d=new Date,e=d.getFullYear(),f=d.getMonth(),h=d.getDate(),j=$("div.total"),o=$("div.item",j),p=[];10>f&&(f="0"+f),10>h&&(h="0"+h),p=["0","0",a("0"),g,g,e+"/"+f+"/"+h];for(var q=0,r=o.length;r>q;q++)$("em",o.eq(q)).html(p[q])}else{var s=[k,l],t=avalon.define("grid",function(a){a.tab=["未领料","已领料"],a.curIndex=0,a.th=[],a.tr=[],a.item=[],a.nodata='<img src="img/loading.gif"/>',a.isCheck=s[a.curIndex].isCheck||!1,a.isOpt=s[a.curIndex].isOpt||!1,a.changeIndex=function(b,d){a.curIndex=b;var e=s[b];a.th=e.th,param=$.extend({},c,e.param),param.pageNum=d||1,param.pageSize=10,COMMON.ajaxFn({url:e.port,obj:param,callback:function(b){if(1==b.code||1==b.ret){var c=b.data.data||[];if(a.tr=[],b.data){if(c instanceof Array)a.tr=c||[];else{var f=[];f.push(c),a.tr=f}$("tr.loading","div.tabitem").hide(),0==a.curIndex?$("a.edit-item").html("领料"):$("a.edit-item").html("编辑"),$("a.delete-item").hide();var g=$("div.page_"+a.curIndex),h=b.data.total||"";if(h&&1!=h){g.show();var i=h;g.pager({pageNumber:d,pageTotal:i,change:function(b){e.param.pageNum=b,a.changeIndex(a.curIndex,b)}})}else g.hide()}else $("tr.loading td").html("暂无数据")}}})},a.getkey=function(a,b){return t.tr.size()>0&&t.tr[a]?t.tr[a][b]:void 0},a.getId=function(b,c){var d=t,e="",f=d.tr[b];s[b];return 0==a.curIndex?e="&type=0":1==a.curIndex&&(e="&type=1"),d.tr.size()>0&&d.tr[b]?"weixiulingliao-opt.html?id="+(f.maintainfortNum||"")+"&carOwner="+(f.truename||"")+"&platenumber="+(f.platenumber||"")+e:void 0},a.addItem=function(){location.href="weixiulingliao-opt.html"},a.editItem=function(){},a.saveItem=function(){$dialog.dialog("show"),editDialog(t.curIndex),$("#tree").on("click","a",function(){editDialog(t.curIndex,{itemName:$(this).html()})})},a.delItem=function(b){var c=s[a.curIndex],d=a.tr[b][c.itemId];$("div.dialog").dialog({title:"窗口提示",content:"确定删除此条数据吗",button:[{text:"确定",cls:"btn-ok",handler:function(b){COMMON.ajaxFn({url:c.delport,obj:{id:d},callback:function(c){(1==c.code||1==c.ret)&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancal",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}});avalon.scan(),t.changeIndex(0)}},100)});