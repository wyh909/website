$(function(){var m,n,b=(window.location.href,document.location.href.indexOf("opt.html")>-1),c={pageNumber:1,pageSize:10},d={id:"商品名称",productID:"商品编号",origin:"产地",type:"分类",carModle:"车型",lastdeliveryDate:"最近出货时间",lastpurchaseDate:"最近进货时间",account:"商品可售数量",unit:"单位(升,个)",safeaccount:"安全数量",suggestBuyprice:"建议购买价格",suggestSaleprice:"建议销售价格",repertory:"仓库名称",origin:"产地",type:"分类",carModle:"车型"},e={id:"库存单号",productName:"商品名称",productID:"商品编号",account:"出库数量",unit:"单位",suggestBuyprice:"出库价格",repertory:"仓库名称",origin:"产地",type:"分类",carModle:"车型",receive:"领料人",handleMan:"办理人员"},f={id:"table_ccgl",itemId:"id",port:"listProductByPage.do",th:d,callback:function(a){$(".loading").hide(),$("table").attr("class","Stable").css("width","1200px"),$("#tree").on("click","a",function(){treeLink(a,$(this).html())})}},g={itemId:"id",port:"listStorageformByPage.do",delport:"deleteStorageform.do",th:e},h={itemId:"id",port:"fandDeliveryformByPage.do",delport:"deleteDeliveryform.do",th:e},i=[{id:"id",name:"库存单号",value:""},{id:"productName",name:"商品名称",value:""},{id:"productID",name:"商品编号",value:""},{id:"account",name:"出库数量",value:""},{id:"unit",name:"单位",value:""},{id:"suggestBuyprice",name:"出库价格",value:""},{id:"repertory",name:"仓库名称",value:""},{id:"origin",name:"产地",value:""},{id:"type",name:"分类",value:""},{id:"carModle",name:"车型",value:""},{id:"receive",name:"领料人",value:""},{id:"handleMan",name:"办理人员",value:""}],j={itemId:"id",edittype:1,editurl:"listStorageformByPage.do",saveurl:"addStorageform.do",editItem:i},k={itemId:"id",edittype:1,editurl:"fandDeliveryformByPage.do",saveurl:"addDeliveryform.do",editItem:i},l=[f,g,h];b?(COMMON.addTpl({edit:1}),m=$("div.opt-tit"),"in"==COMMON.getQuery("orderType")?(m.html("入库单"),COMMON.edit("edit",j)):(m.html("出库单"),COMMON.edit("edit",k))):(COMMON.addTpl({table:1,th:d}),n=avalon.define("childTable",function(a){a.tab=["库存管理","入库","出库"],a.curIndex=0,a.th=d,a.tr=[],a.item=[],a.changeIndex=function(b){var d,e;a.curIndex=b,0==b&&(d={port:"usedCompontInput.do",obj:COMMON.defaultParam,isFold:!1},TREE.tree($("div.tree"),d)),e=l[b],a.th=e.th,COMMON.ajaxFn({url:e.port,obj:c,callback:function(b){var c,d;(1==b.code||1==b.ret)&&(c=b.data.data||[],a.tr=[],b.data?(c instanceof Array?a.tr=c||[]:(d=[],d.push(c),a.tr=d),0==a.curIndex?$("table").css("width","1200px"):$("table").css("width","100%"),$("tr.loading","div.item").hide()):$("tr.loading td").html("暂无数据"))}})},a.getkey=function(a,b){return n.tr.size()>0&&n.tr[a]?n.tr[a][b]:void 0},a.getId=function(b){var d=n,e="";return 1==a.curIndex?e="&orderType=in":2==a.curIndex&&(e="&orderType=out"),d.tr.size()>0&&d.tr[b]?"kufangguanli-opt.html?id="+d.tr[b][l[b].itemId]+e:void 0},a.editItem=function(){},a.saveItem=function(){$dialog.dialog("show"),editDialog(n.curIndex),$("#tree").on("click","a",function(){editDialog(n.curIndex,{itemName:$(this).html()})})},a.delItem=function(b){var c=l[a.curIndex],d=a.tr[b][c.itemId];$("div.dialog").dialog({title:"窗口提示",content:"确定删除此条数据吗",button:[{text:"确定",cls:"btn-ok",handler:function(b){COMMON.ajaxFn({url:c.delport,obj:{id:d},callback:function(c){(1==c.code||1==c.ret)&&(b.dialog("hide"),a.changeIndex(a.curIndex))}})}},{text:"取消",cls:"btn-cancal",handler:function(a){a.dialog("hide")}}],callback:function(a){a.addClass("w400")}})}}),avalon.scan(),n.changeIndex(0))});